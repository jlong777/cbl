/* cb_amino_translate_ascii.c                    http://cbl.sourceforge.net
 *
 * converts nucleotides to amino acids 
 * see original man page at the bottom. This code is the generic version
 * with provision for 32- and 64-bit long ints.
 *
 * Copyright (C) 2003 University of Alaska Fairbanks
 * Arctic Region Supercomputing Center (ARSC)
 * http://www.arsc.edu
 * 
 *   This library is free software; you can redistribute it and/or modify
 *   it under the terms of the GNU Lesser General Public License as
 *   published by the Free Software Foundation; either version 2.1 of the
 *   License, or (at your option) any later version.
 *  
 *   This library is distributed in the hope that it will be useful, but
 *   WITHOUT ANY WARRANTY; without even the implied warranty of
 *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 *   Lesser General Public License for more details.
 *  
 *   You should have received a copy of the GNU Lesser General Public
 *   License along with this library; if not, write to the
 *   Free Software Foundation, Inc.
 *   59 Temple Place, Suite 330
 *   Boston, MA  02111-1307 USA
 *
 * $Id: cb_amino_translate_ascii.c,v 1.8 2004/02/04 18:05:37 jlong777 Exp $
 */

#include "cb_macro.h"

void cb_amino_translate_ascii(long *db, long dblen, 
                              long *am0, long *am1, long *am2 )
{
  long i, length;
  unsigned long num0, num1, num2, numw;
  static unsigned long n2a[64];
  register unsigned long r0,r1,r2,r3,r4,r5,r6,r7,r8,r9,r10,r11,r12,r13,r14,r15;
  
  num0 =  dblen/3;        /* number of amino acids for 1st frame */
  num1 = (dblen-1)/3;
  num2 = (dblen-2)/3;
#ifdef B_ENDIAN

  /* A = 00  C = 01  T/U = 10  G = 11 */
  /* codon translation table, O = stop codon */
  
  n2a[0x00] = 0x4B; /* AAA = K */     n2a[0x01] = 0x4E; /* AAC = N */
  n2a[0x02] = 0x4E; /* AAU = N */     n2a[0x03] = 0x4B; /* AAG = K */
  n2a[0x04] = 0x54; /* ACA = T */     n2a[0x05] = 0x54; /* ACC = T */
  n2a[0x06] = 0x54; /* ACU = T */     n2a[0x07] = 0x54; /* ACG = T */
  n2a[0x08] = 0x49; /* AUA = I */     n2a[0x09] = 0x49; /* AUC = I */
  n2a[0x0A] = 0x49; /* AUU = I */     n2a[0x0B] = 0x4D; /* AUG = M */
  n2a[0x0C] = 0x52; /* AGA = R */     n2a[0x0D] = 0x53; /* AGC = S */
  n2a[0x0E] = 0x53; /* AGU = S */     n2a[0x0F] = 0x52; /* AGG = R */
  n2a[0x10] = 0x51; /* CAA = Q */     n2a[0x11] = 0x48; /* CAC = H */
  n2a[0x12] = 0x48; /* CAU = H */     n2a[0x13] = 0x51; /* CAG = Q */
  n2a[0x14] = 0x50; /* CCA = P */     n2a[0x15] = 0x50; /* CCC = P */
  n2a[0x16] = 0x50; /* CCU = P */     n2a[0x17] = 0x50; /* CCG = P */
  n2a[0x18] = 0x4C; /* CUA = L */     n2a[0x19] = 0x4C; /* CUC = L */
  n2a[0x1A] = 0x4C; /* CUU = L */     n2a[0x1B] = 0x4C; /* CUG = L */
  n2a[0x1C] = 0x52; /* CGA = R */     n2a[0x1D] = 0x52; /* CGC = R */
  n2a[0x1E] = 0x52; /* CGU = R */     n2a[0x1F] = 0x52; /* CGG = R */
  n2a[0x20] = 0x4F; /* UAA = O */     n2a[0x21] = 0x59; /* UAC = Y */
  n2a[0x22] = 0x59; /* UAU = Y */     n2a[0x23] = 0x4F; /* UAG = O */
  n2a[0x24] = 0x53; /* UCA = S */     n2a[0x25] = 0x53; /* UCC = S */
  n2a[0x26] = 0x53; /* UCU = S */     n2a[0x27] = 0x53; /* UCG = S */
  n2a[0x28] = 0x4C; /* UUA = L */     n2a[0x29] = 0x46; /* UUC = F */
  n2a[0x2A] = 0x46; /* UUU = F */     n2a[0x2B] = 0x4C; /* UUG = L */
  n2a[0x2C] = 0x4F; /* UGA = O */     n2a[0x2D] = 0x43; /* UGC = C */
  n2a[0x2E] = 0x43; /* UGU = C */     n2a[0x2F] = 0x57; /* UGG = W */
  n2a[0x30] = 0x45; /* GAA = E */     n2a[0x31] = 0x44; /* GAC = D */
  n2a[0x32] = 0x44; /* GAU = D */     n2a[0x33] = 0x45; /* GAG = E */
  n2a[0x34] = 0x41; /* GCA = A */     n2a[0x35] = 0x41; /* GCC = A */
  n2a[0x36] = 0x41; /* GCU = A */     n2a[0x37] = 0x41; /* GCG = A */
  n2a[0x38] = 0x56; /* GUA = V */     n2a[0x39] = 0x56; /* GUC = V */
  n2a[0x3A] = 0x56; /* GUU = V */     n2a[0x3B] = 0x56; /* GUG = V */
  n2a[0x3C] = 0x47; /* GGA = G */     n2a[0x3D] = 0x47; /* GGC = G */
  n2a[0x3E] = 0x47; /* GGU = G */     n2a[0x3F] = 0x47; /* GGG = G */
#endif

#ifdef L_ENDIAN

  /* A = 00  C = 01  T/U = 10  G = 11 */
  /* codon translation table, reading left-to-right, O = stop codon */
  
  n2a[0x00] = 0x4B; /* AAA = K */     n2a[0x01] = 0x51; /* CAA = Q */
  n2a[0x02] = 0x4F; /* UAA = O */     n2a[0x03] = 0x45; /* GAA = E */
  n2a[0x04] = 0x54; /* ACA = T */     n2a[0x05] = 0x50; /* CCA = P */
  n2a[0x06] = 0x53; /* UCA = S */     n2a[0x07] = 0x41; /* GCA = A */
  n2a[0x08] = 0x49; /* AUA = I */     n2a[0x09] = 0x4C; /* CUA = L */
  n2a[0x0A] = 0x4C; /* UUA = L */     n2a[0x0B] = 0x56; /* GUA = V */
  n2a[0x0C] = 0x52; /* AGA = R */     n2a[0x0D] = 0x52; /* CGA = R */
  n2a[0x0E] = 0x4F; /* UGA = O */     n2a[0x0F] = 0x47; /* GGA = G */
  n2a[0x10] = 0x4E; /* AAC = N */     n2a[0x11] = 0x48; /* CAC = H */
  n2a[0x12] = 0x59; /* UAC = Y */     n2a[0x13] = 0x44; /* GAC = D */
  n2a[0x14] = 0x54; /* ACC = T */     n2a[0x15] = 0x50; /* CCC = P */
  n2a[0x16] = 0x53; /* UCC = S */     n2a[0x17] = 0x41; /* GCC = A */
  n2a[0x18] = 0x49; /* AUC = I */     n2a[0x19] = 0x4C; /* CUC = L */
  n2a[0x1A] = 0x46; /* UUC = F */     n2a[0x1B] = 0x56; /* GUC = V */
  n2a[0x1C] = 0x53; /* AGC = S */     n2a[0x1D] = 0x52; /* CGC = R */
  n2a[0x1E] = 0x43; /* UGC = C */     n2a[0x1F] = 0x47; /* GGC = G */
  n2a[0x20] = 0x4E; /* AAU = N */     n2a[0x21] = 0x48; /* CAU = H */
  n2a[0x22] = 0x59; /* UAU = Y */     n2a[0x23] = 0x44; /* GAU = D */
  n2a[0x24] = 0x54; /* ACU = T */     n2a[0x25] = 0x50; /* CCU = P */
  n2a[0x26] = 0x53; /* UCU = S */     n2a[0x27] = 0x41; /* GCU = A */
  n2a[0x28] = 0x49; /* AUU = I */     n2a[0x29] = 0x4C; /* CUU = L */
  n2a[0x2A] = 0x46; /* UUU = F */     n2a[0x2B] = 0x56; /* GUU = V */
  n2a[0x2C] = 0x53; /* AGU = S */     n2a[0x2D] = 0x52; /* CGU = R */
  n2a[0x2E] = 0x43; /* UGU = C */     n2a[0x2F] = 0x47; /* GGU = G */
  n2a[0x30] = 0x4B; /* AAG = K */     n2a[0x31] = 0x51; /* CAG = Q */
  n2a[0x32] = 0x4F; /* UAG = O */     n2a[0x33] = 0x45; /* GAG = E */
  n2a[0x34] = 0x54; /* ACG = T */     n2a[0x35] = 0x50; /* CCG = P */
  n2a[0x36] = 0x53; /* UCG = S */     n2a[0x37] = 0x41; /* GCG = A */
  n2a[0x38] = 0x4D; /* AUG = M */     n2a[0x39] = 0x4C; /* CUG = L */
  n2a[0x3A] = 0x4C; /* UUG = L */     n2a[0x3B] = 0x56; /* GUG = V */
  n2a[0x3C] = 0x52; /* AGG = R */     n2a[0x3D] = 0x52; /* CGG = R */
  n2a[0x3E] = 0x57; /* UGG = W */     n2a[0x3F] = 0x47; /* GGG = G */
#endif
  
#ifdef LONG32

  numw   = (dblen/3 + 3)/4;  /* number of words for am's */
  length = (dblen + 15)/16;  /* number of words in db */
  
#ifdef B_ENDIAN
#pragma vdir nodep altcode
#pragma _CRI ivdep
  for(i=0; i<length-3; i+=3)
  {
    r0  = 0xFFC00000 & db[i];
    r1  = 0x03FF0000 & db[i];
    r2  = 0x000FFC00 & db[i];
    r3  = 0x00003FF0 & db[i];
    r4  = ((0x000000FF & db[i]) << 2) | (((unsigned long)db[i+1]) >> 30);
    r5  = ((unsigned long)(0x3F000000 & db[i+1]) >> 2) | (r4 << 28);
    r6  = 0x0FFC0000 & db[i+1];
    r7  = 0x003FF000 & db[i+1];
    r8  = 0x0000FFC0 & db[i+1];
    r9  = 0x000003FF & db[i+1];
    r10 = ((unsigned long)(0xFC000000 & db[i+2]) >> 4) | (r9 << 28);
    r11 = 0x3FF00000 & db[i+2];
    r12 = 0x00FFC000 & db[i+2];
    r13 = 0x0003FF00 & db[i+2];
    r14 = 0x00000FFC & db[i+2];
    r15 = ((0x0000003F & db[i+2]) << 4) | (((unsigned long)db[i+3]) >> 28);
    
    am0[4*i/3]   = (n2a[r0  >> 26] << 24) |
                   (n2a[r1  >> 20] << 16) |
                   (n2a[r2  >> 14] <<  8) |
                   (n2a[r3  >>  8]);
	       
    am0[4*i/3+1] = (n2a[r4  >>  4] << 24) |
                   (n2a[r5  >> 26] << 16) |
                   (n2a[r6  >> 22] <<  8) |
	           (n2a[r7  >> 16]);
	       
    am0[4*i/3+2] = (n2a[r8  >> 10] << 24) |
                   (n2a[r9  >>  4] << 16) |
	           (n2a[r10 >> 26] <<  8) |
	           (n2a[r11 >> 24]);
	       
    am0[4*i/3+3] = (n2a[r12 >> 18] << 24) |
                   (n2a[r13 >> 12] << 16) |
	           (n2a[r14 >>  6] <<  8) |
	           (n2a[r15 >>  4]);
		   
    am1[4*i/3]   = (n2a[(r0 <<  2) >> 26] << 24) |
                   (n2a[(r1 <<  8) >> 26] << 16) |
                   (n2a[(r2 << 14) >> 26] <<  8) |
                   (n2a[(r3 << 20) >> 26]);
    
    am1[4*i/3+1] = (n2a[(r4 << 24) >> 26] << 24) |
                   (n2a[(r5 <<  2) >> 26] << 16) |
                   (n2a[(r6 <<  6) >> 26] <<  8) |
	           (n2a[(r7 << 12) >> 26]);
    
    am1[4*i/3+2] = (n2a[(r8  << 18) >> 26] << 24) |
                   (n2a[(r9  << 24) >> 26] << 16) |
	           (n2a[(r10 <<  2) >> 26] <<  8) |
	           (n2a[(r11 <<  4) >> 26]);
    
    am1[4*i/3+3] = (n2a[(r12 << 10) >> 26] << 24) |
                   (n2a[(r13 << 16) >> 26] << 16) |
	           (n2a[(r14 << 22) >> 26] <<  8) |
	           (n2a[(r15 << 24) >> 26]);
		   
    am2[4*i/3]   = (n2a[(r0 <<  4) >> 26] << 24) |
                   (n2a[(r1 << 10) >> 26] << 16) |
                   (n2a[(r2 << 16) >> 26] <<  8) |
                   (n2a[(r3 << 22) >> 26]);
    
    am2[4*i/3+1] = (n2a[(r4 << 26) >> 26] << 24) |
                   (n2a[(r5 <<  4) >> 26] << 16) |
                   (n2a[(r6 <<  8) >> 26] <<  8) |
	           (n2a[(r7 << 14) >> 26]);
    
    am2[4*i/3+2] = (n2a[(r8  << 20) >> 26] << 24) |
                   (n2a[(r9  << 26) >> 26] << 16) |
	           (n2a[(r10 <<  4) >> 26] <<  8) |
	           (n2a[(r11 <<  6) >> 26]);
    
    am2[4*i/3+3] = (n2a[(r12 << 12) >> 26] << 24) |
                   (n2a[(r13 << 18) >> 26] << 16) |
	           (n2a[(r14 << 24) >> 26] <<  8) |
	           (n2a[(r15 << 26) >> 26]);
  }
  r0  = 0xFFC00000 & db[i];
  r1  = 0x03FF0000 & db[i];
  r2  = 0x000FFC00 & db[i];
  r3  = 0x00003FF0 & db[i];
  if(i==length-3)
  {
    r4  = ((0x000000FF & db[i]) << 2) | (((unsigned long)db[i+1]) >> 30);
    r5  = ((unsigned long)(0x3F000000 & db[i+1]) >> 2) | (r4 << 28);
    r6  = 0x0FFC0000 & db[i+1];
    r7  = 0x003FF000 & db[i+1];
    r8  = 0x0000FFC0 & db[i+1];
    r9  = 0x000003FF & db[i+1];
    r10 = ((unsigned long)(0xFC000000 & db[i+2]) >> 4) | (r9 << 28);
    r11 = 0x3FF00000 & db[i+2];
    r12 = 0x00FFC000 & db[i+2];
    r13 = 0x0003FF00 & db[i+2];
    r14 = 0x00000FFC & db[i+2];
    r15 = (unsigned long)(0x0000003F & db[i+2]);
  }
  else if(i==length-2)
  {
    r4  = ((0x000000FF & db[i]) << 2) | (((unsigned long)db[i+1]) >> 30);
    r5  = ((unsigned long)(0x3F000000 & db[i+1]) >> 2) | (r4 << 28);
    r6  = 0x0FFC0000 & db[i+1];
    r7  = 0x003FF000 & db[i+1];
    r8  = 0x0000FFC0 & db[i+1];
    r9  = 0x000003FF & db[i+1];
    r10 = r9 << 28;
    r11 = r12 = r13 = r14 = r15 = 0x0;
  }
  else
  {
    r4  = (unsigned long)(0x000000FF & db[i]) << 2;
    r5  = r4 << 28;
    r6 = r7 = r8 = r9 = r10 = r11 = r12 = r13 = r14 = r15 = 0x0;
  }
  if(4*i/3 < numw)
  {
    am0[4*i/3]   = ((4*(4*i/3) + 1 > num0)? 0x00:(n2a[r0  >> 26] << 24)) |
		   ((4*(4*i/3) + 2 > num0)? 0x00:(n2a[r1  >> 20] << 16)) |
		   ((4*(4*i/3) + 3 > num0)? 0x00:(n2a[r2  >> 14] <<  8)) |
		   ((4*(4*i/3) + 4 > num0)? 0x00:(n2a[r3  >>  8]));
    am1[4*i/3]   = ((4*(4*i/3) + 1 > num1)? 0x00:(n2a[(r0 <<  2) >> 26] << 24)) |
		   ((4*(4*i/3) + 2 > num1)? 0x00:(n2a[(r1 <<  8) >> 26] << 16)) |
		   ((4*(4*i/3) + 3 > num1)? 0x00:(n2a[(r2 << 14) >> 26] <<  8)) |
		   ((4*(4*i/3) + 4 > num1)? 0x00:(n2a[(r3 << 20) >> 26]));
    am2[4*i/3]   = ((4*(4*i/3) + 1 > num2)? 0x00:(n2a[(r0 <<  4) >> 26] << 24)) |
		   ((4*(4*i/3) + 2 > num2)? 0x00:(n2a[(r1 << 10) >> 26] << 16)) |
		   ((4*(4*i/3) + 3 > num2)? 0x00:(n2a[(r2 << 16) >> 26] <<  8)) |
		   ((4*(4*i/3) + 4 > num2)? 0x00:(n2a[(r3 << 22) >> 26]));
  }
  if(4*i/3 + 1 < numw)
  {
    am0[4*i/3+1] = ((4*(4*i/3) + 5 > num0)? 0x00:(n2a[r4  >>  4] << 24)) |
		   ((4*(4*i/3) + 6 > num0)? 0x00:(n2a[r5  >> 26] << 16)) |
		   ((4*(4*i/3) + 7 > num0)? 0x00:(n2a[r6  >> 22] <<  8)) |
		   ((4*(4*i/3) + 8 > num0)? 0x00:(n2a[r7  >> 16]));
    am1[4*i/3+1] = ((4*(4*i/3) + 5 > num1)? 0x00:(n2a[(r4 << 24) >> 26] << 24)) |
		   ((4*(4*i/3) + 6 > num1)? 0x00:(n2a[(r5 <<  2) >> 26] << 16)) |
		   ((4*(4*i/3) + 7 > num1)? 0x00:(n2a[(r6 <<  6) >> 26] <<  8)) |
		   ((4*(4*i/3) + 8 > num1)? 0x00:(n2a[(r7 << 12) >> 26]));
    am2[4*i/3+1] = ((4*(4*i/3) + 5 > num2)? 0x00:(n2a[(r4 << 26) >> 26] << 24)) |
                   ((4*(4*i/3) + 6 > num2)? 0x00:(n2a[(r5 <<  4) >> 26] << 16)) |
		   ((4*(4*i/3) + 7 > num2)? 0x00:(n2a[(r6 <<  8) >> 26] <<  8)) |
		   ((4*(4*i/3) + 8 > num2)? 0x00:(n2a[(r7 << 14) >> 26]));
  }
  if(4*i/3 + 2 < numw)
  {
    am0[4*i/3+2] = ((4*(4*i/3) +  9 > num0)? 0x00:(n2a[r8  >> 10] << 24)) |
		   ((4*(4*i/3) + 10 > num0)? 0x00:(n2a[r9  >>  4] << 16)) |
		   ((4*(4*i/3) + 11 > num0)? 0x00:(n2a[r10 >> 26] <<  8)) |
		   ((4*(4*i/3) + 12 > num0)? 0x00:(n2a[r11 >> 24]));
    am1[4*i/3+2] = ((4*(4*i/3) +  9 > num1)? 0x00:(n2a[(r8  << 18) >> 26] << 24)) |
		   ((4*(4*i/3) + 10 > num1)? 0x00:(n2a[(r9  << 24) >> 26] << 16)) |
		   ((4*(4*i/3) + 11 > num1)? 0x00:(n2a[(r10 <<  2) >> 26] <<  8)) |
		   ((4*(4*i/3) + 12 > num1)? 0x00:(n2a[(r11 <<  4) >> 26]));
    am2[4*i/3+2] = ((4*(4*i/3) +  9 > num2)? 0x00:(n2a[(r8  << 20) >> 26] << 24)) |
                   ((4*(4*i/3) + 10 > num2)? 0x00:(n2a[(r9  << 26) >> 26] << 16)) |
		   ((4*(4*i/3) + 11 > num2)? 0x00:(n2a[(r10 <<  4) >> 26] <<  8)) |
		   ((4*(4*i/3) + 12 > num2)? 0x00:(n2a[(r11 <<  6) >> 26]));
  }
  if(4*i/3 + 3 < numw)
  {
    am0[4*i/3+3] = ((4*(4*i/3) + 13 > num0)? 0x00:(n2a[r12 >> 18] << 24)) |
                   ((4*(4*i/3) + 14 > num0)? 0x00:(n2a[r13 >> 12] << 16)) |
		   ((4*(4*i/3) + 15 > num0)? 0x00:(n2a[r14 >>  6] <<  8)) |
		   ((4*(4*i/3) + 16 > num0)? 0x00:(n2a[r15]));
    am1[4*i/3+3] = ((4*(4*i/3) + 13 > num1)? 0x00:(n2a[(r12 << 10) >> 26] << 24)) |
                   ((4*(4*i/3) + 14 > num1)? 0x00:(n2a[(r13 << 16) >> 26] << 16)) |
		   ((4*(4*i/3) + 15 > num1)? 0x00:(n2a[(r14 << 22) >> 26] <<  8));
    am2[4*i/3+3] = ((4*(4*i/3) + 13 > num2)? 0x00:(n2a[(r12 << 12) >> 26] << 24)) |
                   ((4*(4*i/3) + 14 > num2)? 0x00:(n2a[(r13 << 18) >> 26] << 16)) |
		   ((4*(4*i/3) + 15 > num2)? 0x00:(n2a[(r14 << 24) >> 26] <<  8));
  }
#endif /* big_endian */

#ifdef L_ENDIAN
#pragma vdir nodep altcode
#pragma _CRI ivdep
  for(i=0; i<length-3; i+=3)
  {
    r0  = 0x000003FF & db[i];
    r1  = 0x0000FFC0 & db[i];
    r2  = 0x003FF000 & db[i];
    r3  = 0x0FFC0000 & db[i];
    r4  = (((unsigned long)db[i]) >> 24) | ((0x00000003 & db[i+1]) << 8);
    r5  = ((0x000000FC & db[i+1]) <<  2) | (r4 >> 6);
    r6  = 0x00003FF0 & db[i+1];
    r7  = 0x000FFC00 & db[i+1];
    r8  = 0x03FF0000 & db[i+1];
    r9  = 0xFFC00000 & db[i+1];
    r10 = (((unsigned long)db[i+1]) >> 28) | ((0x0000003F & db[i+2]) << 4);
    r11 = 0x00000FFC & db[i+2];
    r12 = 0x0003FF00 & db[i+2];
    r13 = 0x00FFC000 & db[i+2];
    r14 = 0x3FF00000 & db[i+2];
    r15 = (((unsigned long) db[i+2]) >> 26) | 
           ((unsigned long)(db[i+3]  << 28) >> 22);
    
    am0[4*i/3]   = (n2a[ r0  & 0x3F])             |
                   (n2a[(r1  << 20) >> 26] <<  8) |
                   (n2a[(r2  << 14) >> 26] << 16) |
                   (n2a[(r3  <<  8) >> 26] << 24);
	       
    am0[4*i/3+1] = (n2a[ r4  & 0x3F])             |
                   (n2a[(r5  << 26) >> 26] <<  8) |
                   (n2a[(r6  << 22) >> 26] << 16) |
	           (n2a[(r7  << 16) >> 26] << 24);
	       
    am0[4*i/3+2] = (n2a[(r8  << 10) >> 26])       |
                   (n2a[(r9  <<  4) >> 26] <<  8) |
	           (n2a[ r10 & 0x3F]       << 16) |
	           (n2a[(r11 << 24) >> 26] << 24);
	       
    am0[4*i/3+3] = (n2a[(r12 << 18) >> 26])       |
                   (n2a[(r13 << 12) >> 26] <<  8) |
	           (n2a[(r14 <<  6) >> 26] << 16) |
	           (n2a[ r15 & 0x3F]       << 24);
		   	   
    am1[4*i/3]   = (n2a[(r0  << 24) >> 26])       |
                   (n2a[(r1  << 18) >> 26] <<  8) |
                   (n2a[(r2  << 12) >> 26] << 16) |
                   (n2a[(r3  <<  6) >> 26] << 24);
    
    am1[4*i/3+1] = (n2a[(r4  << 24) >> 26])       |
                   (n2a[(r5  << 24) >> 26] <<  8) |
                   (n2a[(r6  << 20) >> 26] << 16) |
	           (n2a[(r7  << 14) >> 26] << 24);
    
    am1[4*i/3+2] = (n2a[(r8  <<  8) >> 26])       |
                   (n2a[(r9  <<  2) >> 26] <<  8) |
	           (n2a[(r10 << 24) >> 26] << 16) |
	           (n2a[(r11 << 22) >> 26] << 24);
    
    am1[4*i/3+3] = (n2a[(r12 << 16) >> 26])       |
                   (n2a[(r13 << 10) >> 26] <<  8) |
	           (n2a[(r14 <<  4) >> 26] << 16) |
	           (n2a[(r15 << 24) >> 26] << 24);
		   
    am2[4*i/3]   = (n2a[r0 >>  4])       |
                   (n2a[r1 >> 10] <<  8) |
                   (n2a[r2 >> 16] << 16) |
                   (n2a[r3 >> 22] << 24);
    
    am2[4*i/3+1] = (n2a[r4 >>  4])       |
                   (n2a[r5 >>  4] <<  8) |
                   (n2a[r6 >>  8] << 16) |
	           (n2a[r7 >> 14] << 24);
    
    am2[4*i/3+2] = (n2a[r8  >> 20])       |
                   (n2a[r9  >> 26] <<  8) |
	           (n2a[r10 >>  4] << 16) |
	           (n2a[r11 >>  6] << 24);
    
    am2[4*i/3+3] = (n2a[r12 >> 12]) |
                   (n2a[r13 >> 18] <<  8) |
	           (n2a[r14 >> 24] << 16) |
	           (n2a[r15 >>  4] << 24);
  }
  r0  = 0x000003FF & db[i];
  r1  = 0x0000FFC0 & db[i];
  r2  = 0x003FF000 & db[i];
  r3  = 0x0FFC0000 & db[i];
  if(i==length-3)
  {
    r4  = (((unsigned long)db[i]) >> 24) | ((0x00000003 & db[i+1]) << 8);
    r5  = ((0x000000FC & db[i+1]) << 2) | (r4 >> 6);
    r6  = 0x00003FF0 & db[i+1];
    r7  = 0x000FFC00 & db[i+1];
    r8  = 0x03FF0000 & db[i+1];
    r9  = 0xFFC00000 & db[i+1];
    r10 = (((unsigned long)db[i+1]) >> 28) | ((0x0000003F & db[i+2]) << 4);
    r11 = 0x00000FFC & db[i+2];
    r12 = 0x0003FF00 & db[i+2];
    r13 = 0x00FFC000 & db[i+2];
    r14 = 0x3FF00000 & db[i+2];
    r15 = 0xFC000000 & db[i+2];
  }
  else if(i==length-2)
  {
    r4  = (((unsigned long)db[i]) >> 24) | ((0x00000003 & db[i+1]) << 8);
    r5  = ((0x000000FC & db[i+1]) << 2) | (r4 >> 6);
    r6  = 0x00003FF0 & db[i+1];
    r7  = 0x000FFC00 & db[i+1];
    r8  = 0x03FF0000 & db[i+1];
    r9  = 0xFFC00000 & db[i+1];
    r10 = ((unsigned long)db[i+1]) >> 28;
    r11 = r12 = r13 = r14 = r15 = 0x0;
  }
  else
  {
    r4  = ((unsigned long)db[i]) >> 24;
    r5  = r4 >> 6;
    r6 = r7 = r8 = r9 = r10 = r11 = r12 = r13 = r14 = r15 = 0x0;
  }
  if(4*i/3 < numw)
  {
    am0[4*i/3] = ((4*(4*i/3) + 1 > num0)? 0x00:(n2a[ r0  & 0x3F]))            |
                 ((4*(4*i/3) + 2 > num0)? 0x00:(n2a[(r1 << 20) >> 26] <<  8)) |
                 ((4*(4*i/3) + 3 > num0)? 0x00:(n2a[(r2 << 14) >> 26] << 16)) |
                 ((4*(4*i/3) + 4 > num0)? 0x00:(n2a[(r3 <<  8) >> 26] << 24));
    am1[4*i/3] = ((4*(4*i/3) + 1 > num1)? 0x00:(n2a[(r0 << 24) >> 26]))       |
                 ((4*(4*i/3) + 2 > num1)? 0x00:(n2a[(r1 << 18) >> 26] <<  8)) |
                 ((4*(4*i/3) + 3 > num1)? 0x00:(n2a[(r2 << 12) >> 26] << 16)) |
                 ((4*(4*i/3) + 4 > num1)? 0x00:(n2a[(r3 <<  6) >> 26] << 24));
    am2[4*i/3] = ((4*(4*i/3) + 1 > num2)? 0x00:(n2a[r0 >>  4]))       |
                 ((4*(4*i/3) + 2 > num2)? 0x00:(n2a[r1 >> 10] <<  8)) |
                 ((4*(4*i/3) + 3 > num2)? 0x00:(n2a[r2 >> 16] << 16)) |
                 ((4*(4*i/3) + 4 > num2)? 0x00:(n2a[r3 >> 22] << 24));
  }
  if(4*i/3 + 1 < numw)
  {
    am0[4*i/3+1] = ((4*(4*i/3) + 5 > num0)? 0x00:(n2a[ r4  & 0x3F]))            |
                   ((4*(4*i/3) + 6 > num0)? 0x00:(n2a[(r5 << 26) >> 26] <<  8)) |
                   ((4*(4*i/3) + 7 > num0)? 0x00:(n2a[(r6 << 22) >> 26] << 16)) |
	           ((4*(4*i/3) + 8 > num0)? 0x00:(n2a[(r7 << 16) >> 26] << 24));
    am1[4*i/3+1] = ((4*(4*i/3) + 5 > num1)? 0x00:(n2a[(r4  << 24) >> 26]))       |
                   ((4*(4*i/3) + 6 > num1)? 0x00:(n2a[(r5  << 24) >> 26] <<  8)) |
                   ((4*(4*i/3) + 7 > num1)? 0x00:(n2a[(r6  << 20) >> 26] << 16)) |
	           ((4*(4*i/3) + 8 > num1)? 0x00:(n2a[(r7  << 14) >> 26] << 24));
    am2[4*i/3+1] = ((4*(4*i/3) + 5 > num2)? 0x00:(n2a[r4 >>  4]))       |
                   ((4*(4*i/3) + 6 > num2)? 0x00:(n2a[r5 >>  4] <<  8)) |
                   ((4*(4*i/3) + 7 > num2)? 0x00:(n2a[r6 >>  8] << 16)) |
	           ((4*(4*i/3) + 8 > num2)? 0x00:(n2a[r7 >> 14] << 24));
  }
  if(4*i/3 + 2 < numw)
  {
    am0[4*i/3+2] = ((4*(4*i/3) +  9 > num0)? 0x00:(n2a[(r8  << 10) >> 26]))       |
                   ((4*(4*i/3) + 10 > num0)? 0x00:(n2a[(r9  <<  4) >> 26] <<  8)) |
	           ((4*(4*i/3) + 11 > num0)? 0x00:(n2a[ r10 & 0x3F]       << 16)) |
	           ((4*(4*i/3) + 12 > num0)? 0x00:(n2a[(r11 << 24) >> 26] << 24));
    am1[4*i/3+2] = ((4*(4*i/3) +  9 > num1)? 0x00:(n2a[(r8  <<  8) >> 26]))       |
                   ((4*(4*i/3) + 10 > num1)? 0x00:(n2a[(r9  <<  2) >> 26] <<  8)) |
	           ((4*(4*i/3) + 11 > num1)? 0x00:(n2a[(r10 << 24) >> 26] << 16)) |
	           ((4*(4*i/3) + 12 > num1)? 0x00:(n2a[(r11 << 22) >> 26] << 24));
    am2[4*i/3+2] = ((4*(4*i/3) +  9 > num2)? 0x00:(n2a[r8  >> 20]))       |
                   ((4*(4*i/3) + 10 > num2)? 0x00:(n2a[r9  >> 26] <<  8)) |
	           ((4*(4*i/3) + 11 > num2)? 0x00:(n2a[r10 >>  4] << 16)) |
	           ((4*(4*i/3) + 12 > num2)? 0x00:(n2a[r11 >>  6] << 24));
  }
  if(4*i/3 + 3 < numw)
  {       
    am0[4*i/3+3] = ((4*(4*i/3) + 13 > num0)? 0x00:(n2a[(r12 << 18) >> 26]))       |
                   ((4*(4*i/3) + 14 > num0)? 0x00:(n2a[(r13 << 12) >> 26] <<  8)) |
	           ((4*(4*i/3) + 15 > num0)? 0x00:(n2a[(r14 <<  6) >> 26] << 16)) |
	           ((4*(4*i/3) + 16 > num0)? 0x00:(n2a[ r15        >> 26] << 24));
    
    am1[4*i/3+3] = ((4*(4*i/3) + 13 > num1)? 0x00:(n2a[(r12 << 16) >> 26]))       |
                   ((4*(4*i/3) + 14 > num1)? 0x00:(n2a[(r13 << 10) >> 26] <<  8)) |
	           ((4*(4*i/3) + 15 > num1)? 0x00:(n2a[(r14 <<  4) >> 26] << 16));
		 
    am2[4*i/3+3] = ((4*(4*i/3) + 13 > num2)? 0x00:(n2a[r12 >> 12]))       |
                   ((4*(4*i/3) + 14 > num2)? 0x00:(n2a[r13 >> 18] <<  8)) |
	           ((4*(4*i/3) + 15 > num2)? 0x00:(n2a[r14 >> 24] << 16));
  }
#endif /* little_endian */
#endif /* 32-bit */

#ifdef LONG64

  numw   = (dblen/3 + 7)/8;  /* number of words for am's */
  length = (dblen + 31)/32;  /* number of words in db */

#ifdef B_ENDIAN
#pragma vdir nodep altcode
#pragma _CRI ivdep
  for(i=0; i<length-3; i+=3)
  {
    r0  = 0xFFFF000000000000 & db[i];
    r1  = 0x000FFFF000000000 & db[i];
    r2  = 0x000000FFFF000000 & db[i];
    r3  = 0x000000000FFFF000 & db[i];
    r4  = 0x000000000000FFFF & db[i];
    r5  = ((0x000000000000000F & db[i])   << 12) | 
                (((unsigned long)db[i+1]) >> 52);
    r6  = 0x00FFFF0000000000 & db[i+1];
    r7  = 0x00000FFFF0000000 & db[i+1];
    r8  = 0x00000000FFFF0000 & db[i+1];
    r9  = 0x00000000000FFFF0 & db[i+1];
    r10 = ((0x00000000000000FF & db[i+1]) <<  8) |
                (((unsigned long)db[i+2]) >> 56);
    r11 = 0x0FFFF00000000000 & db[i+2];
    r12 = 0x0000FFFF00000000 & db[i+2];
    r13 = 0x0000000FFFF00000 & db[i+2];
    r14 = 0x0000000000FFFF00 & db[i+2];
    r15 = ((0x0000000000000FFF & db[i+2]) <<  4) |
                (((unsigned long)db[i+3]) >> 60);
    
    am0[4*i/3]   = (n2a[r0  >> 58] << 56) | (n2a[(r0  <<  6) >> 58] << 48) |
		   (n2a[r1  >> 46] << 40) | (n2a[(r1  << 18) >> 58] << 32) |
		   (n2a[r2  >> 34] << 24) | (n2a[(r2  << 30) >> 58] << 16) |
		   (n2a[r3  >> 22] <<  8) | (n2a[(r3  << 42) >> 58]);
    
    am0[4*i/3+1] = (n2a[r4  >> 10] << 56) | (n2a[(r4  << 54) >> 58] << 48) |
		   (n2a[r5  >> 10] << 40) | (n2a[(r5  << 54) >> 58] << 32) |
		   (n2a[r6  >> 50] << 24) | (n2a[(r6  << 14) >> 58] << 16) |
		   (n2a[r7  >> 38] <<  8) | (n2a[(r7  << 26) >> 58]);
    
    am0[4*i/3+2] = (n2a[r8  >> 26] << 56) | (n2a[(r8  << 38) >> 58] << 48) |
		   (n2a[r9  >> 14] << 40) | (n2a[(r9  << 50) >> 58] << 32) |
		   (n2a[r10 >> 10] << 24) | (n2a[(r10 << 54) >> 58] << 16) |
		   (n2a[r11 >> 54] <<  8) | (n2a[(r11 << 10) >> 58]);
    
    am0[4*i/3+3] = (n2a[r12 >> 42] << 56) | (n2a[(r12 << 22) >> 58] << 48) |
                   (n2a[r13 >> 30] << 40) | (n2a[(r13 << 34) >> 58] << 32) |
		   (n2a[r14 >> 18] << 24) | (n2a[(r14 << 46) >> 58] << 16) |
		   (n2a[r15 >> 10] <<  8) | (n2a[(r15 << 54) >> 58]);
    
    
    am1[4*i/3]   = (n2a[(r0  <<  2) >> 58] << 56) | (n2a[(r0  <<  8) >> 58] << 48) |
		   (n2a[(r1  << 14) >> 58] << 40) | (n2a[(r1  << 20) >> 58] << 32) |
		   (n2a[(r2  << 26) >> 58] << 24) | (n2a[(r2  << 32) >> 58] << 16) |
		   (n2a[(r3  << 38) >> 58] <<  8) | (n2a[(r3  << 44) >> 58]);
    
    am1[4*i/3+1] = (n2a[(r4  << 50) >> 58] << 56) | (n2a[(r4  << 56) >> 58] << 48) |
		   (n2a[(r5  << 50) >> 58] << 40) | (n2a[(r5  << 56) >> 58] << 32) |
		   (n2a[(r6  << 10) >> 58] << 24) | (n2a[(r6  << 16) >> 58] << 16) |
		   (n2a[(r7  << 22) >> 58] <<  8) | (n2a[(r7  << 28) >> 58]);
    
    am1[4*i/3+2] = (n2a[(r8  << 34) >> 58] << 56) | (n2a[(r8  << 40) >> 58] << 48) |
		   (n2a[(r9  << 46) >> 58] << 40) | (n2a[(r9  << 52) >> 58] << 32) |
		   (n2a[(r10 << 50) >> 58] << 24) | (n2a[(r10 << 56) >> 58] << 16) |
		   (n2a[(r11 <<  6) >> 58] <<  8) | (n2a[(r11 << 12) >> 58]);
    
    am1[4*i/3+3] = (n2a[(r12 << 18) >> 58] << 56) | (n2a[(r12 << 24) >> 58] << 48) |
                   (n2a[(r13 << 30) >> 58] << 40) | (n2a[(r13 << 36) >> 58] << 32) |
		   (n2a[(r14 << 42) >> 58] << 24) | (n2a[(r14 << 48) >> 58] << 16) |
		   (n2a[(r15 << 50) >> 58] <<  8) | (n2a[(r15 << 56) >> 58]);
    
    
    am2[4*i/3]   = (n2a[(r0  <<  4) >> 58] << 56) | (n2a[(r0  << 10) >> 58] << 48) |
		   (n2a[(r1  << 16) >> 58] << 40) | (n2a[(r1  << 22) >> 58] << 32) |
		   (n2a[(r2  << 28) >> 58] << 24) | (n2a[(r2  << 34) >> 58] << 16) |
		   (n2a[(r3  << 40) >> 58] <<  8) | (n2a[(r3  << 46) >> 58]);
    
    am2[4*i/3+1] = (n2a[(r4  << 52) >> 58] << 56) | (n2a[(r4  << 58) >> 58] << 48) |
		   (n2a[(r5  << 52) >> 58] << 40) | (n2a[(r5  << 58) >> 58] << 32) |
		   (n2a[(r6  << 12) >> 58] << 24) | (n2a[(r6  << 18) >> 58] << 16) |
		   (n2a[(r7  << 24) >> 58] <<  8) | (n2a[(r7  << 30) >> 58]);
    
    am2[4*i/3+2] = (n2a[(r8  << 36) >> 58] << 56) | (n2a[(r8  << 42) >> 58] << 48) |
		   (n2a[(r9  << 48) >> 58] << 40) | (n2a[(r9  << 54) >> 58] << 32) |
		   (n2a[(r10 << 52) >> 58] << 24) | (n2a[(r10 << 58) >> 58] << 16) |
		   (n2a[(r11 <<  8) >> 58] <<  8) | (n2a[(r11 << 14) >> 58]);
    
    am2[4*i/3+3] = (n2a[(r12 << 20) >> 58] << 56) | (n2a[(r12 << 26) >> 58] << 48) |
                   (n2a[(r13 << 32) >> 58] << 40) | (n2a[(r13 << 38) >> 58] << 32) |
		   (n2a[(r14 << 44) >> 58] << 24) | (n2a[(r14 << 50) >> 58] << 16) |
		   (n2a[(r15 << 52) >> 58] <<  8) | (n2a[(r15 << 58) >> 58]);
  }
  r0  = 0xFFFF000000000000 & db[i];
  r1  = 0x000FFFF000000000 & db[i];
  r2  = 0x000000FFFF000000 & db[i];
  r3  = 0x000000000FFFF000 & db[i];
  r4  = 0x000000000000FFFF & db[i];
  if(i==length-3)
  {
    r5  = ((0x000000000000000F & db[i])   << 12) | 
                (((unsigned long)db[i+1]) >> 52);
    r6  = 0x00FFFF0000000000 & db[i+1];
    r7  = 0x00000FFFF0000000 & db[i+1];
    r8  = 0x00000000FFFF0000 & db[i+1];
    r9  = 0x00000000000FFFF0 & db[i+1];
    r10 = ((0x00000000000000FF & db[i+1]) <<  8) |
                (((unsigned long)db[i+2]) >> 56);
    r11 = 0x0FFFF00000000000 & db[i+2];
    r12 = 0x0000FFFF00000000 & db[i+2];
    r13 = 0x0000000FFFF00000 & db[i+2];
    r14 = 0x0000000000FFFF00 & db[i+2];
    r15 = 0x0000000000000FFF & db[i+2];
  }
  else if(i==length-2)
  {
    r5  = ((0x000000000000000F & db[i])   << 12) | 
                (((unsigned long)db[i+1]) >> 52);
    r6  = 0x00FFFF0000000000 & db[i+1];
    r7  = 0x00000FFFF0000000 & db[i+1];
    r8  = 0x00000000FFFF0000 & db[i+1];
    r9  = 0x00000000000FFFF0 & db[i+1];
    r10 = (0x00000000000000FF & db[i+1]) << 8;
    r11 = r12 = r13 = r14 = r15 = 0x0;
  }
  else
  {
    r5  = (0x000000000000000F & db[i]) << 12;
    r6 = r7 = r8 = r9 = r10 = r11 = r12 = r13 = r14 = r15 = 0x0;
  }
  if(4*i/3 < numw)
  {
    am0[4*i/3] = ((8*(4*i/3) + 1 > num0)? 0x00:(n2a[ r0         >> 58] << 56)) |
                 ((8*(4*i/3) + 2 > num0)? 0x00:(n2a[(r0  <<  6) >> 58] << 48)) |
	         ((8*(4*i/3) + 3 > num0)? 0x00:(n2a[ r1         >> 46] << 40)) |
		 ((8*(4*i/3) + 4 > num0)? 0x00:(n2a[(r1  << 18) >> 58] << 32)) |
	         ((8*(4*i/3) + 5 > num0)? 0x00:(n2a[ r2         >> 34] << 24)) |
		 ((8*(4*i/3) + 6 > num0)? 0x00:(n2a[(r2  << 30) >> 58] << 16)) |
	         ((8*(4*i/3) + 7 > num0)? 0x00:(n2a[ r3         >> 22] <<  8)) |
		 ((8*(4*i/3) + 8 > num0)? 0x00:(n2a[(r3  << 42) >> 58]));
    am1[4*i/3] = ((8*(4*i/3) + 1 > num1)? 0x00:(n2a[(r0  <<  2) >> 58] << 56)) |
                 ((8*(4*i/3) + 2 > num1)? 0x00:(n2a[(r0  <<  8) >> 58] << 48)) |
		 ((8*(4*i/3) + 3 > num1)? 0x00:(n2a[(r1  << 14) >> 58] << 40)) |
		 ((8*(4*i/3) + 4 > num1)? 0x00:(n2a[(r1  << 20) >> 58] << 32)) |
		 ((8*(4*i/3) + 5 > num1)? 0x00:(n2a[(r2  << 26) >> 58] << 24)) |
		 ((8*(4*i/3) + 6 > num1)? 0x00:(n2a[(r2  << 32) >> 58] << 16)) |
		 ((8*(4*i/3) + 7 > num1)? 0x00:(n2a[(r3  << 38) >> 58] <<  8)) |
		 ((8*(4*i/3) + 8 > num1)? 0x00:(n2a[(r3  << 44) >> 58]));
    am2[4*i/3] = ((8*(4*i/3) + 1 > num2)? 0x00:(n2a[(r0  <<  4) >> 58] << 56)) |
                 ((8*(4*i/3) + 2 > num2)? 0x00:(n2a[(r0  << 10) >> 58] << 48)) |
		 ((8*(4*i/3) + 3 > num2)? 0x00:(n2a[(r1  << 16) >> 58] << 40)) |
		 ((8*(4*i/3) + 4 > num2)? 0x00:(n2a[(r1  << 22) >> 58] << 32)) |
		 ((8*(4*i/3) + 5 > num2)? 0x00:(n2a[(r2  << 28) >> 58] << 24)) |
		 ((8*(4*i/3) + 6 > num2)? 0x00:(n2a[(r2  << 34) >> 58] << 16)) |
		 ((8*(4*i/3) + 7 > num2)? 0x00:(n2a[(r3  << 40) >> 58] <<  8)) |
		 ((8*(4*i/3) + 8 > num2)? 0x00:(n2a[(r3  << 46) >> 58]));
  }
  if(4*i/3 + 1 < numw)
  {
    am0[4*i/3+1] = ((8*(4*i/3) +  9 > num0)? 0x00:(n2a[ r4      >> 10] << 56)) |
                   ((8*(4*i/3) + 10 > num0)? 0x00:(n2a[(r4<<54) >> 58] << 48)) |
		   ((8*(4*i/3) + 11 > num0)? 0x00:(n2a[ r5      >> 10] << 40)) |
		   ((8*(4*i/3) + 12 > num0)? 0x00:(n2a[(r5<<54) >> 58] << 32)) |
		   ((8*(4*i/3) + 13 > num0)? 0x00:(n2a[ r6      >> 50] << 24)) |
		   ((8*(4*i/3) + 14 > num0)? 0x00:(n2a[(r6<<14) >> 58] << 16)) |
		   ((8*(4*i/3) + 15 > num0)? 0x00:(n2a[ r7      >> 38] <<  8)) |
		   ((8*(4*i/3) + 16 > num0)? 0x00:(n2a[(r7<<26) >> 58]));
    am1[4*i/3+1] = ((8*(4*i/3) +  9 > num1)? 0x00:(n2a[(r4<<50) >> 58] << 56)) |
                   ((8*(4*i/3) + 10 > num1)? 0x00:(n2a[(r4<<56) >> 58] << 48)) |
		   ((8*(4*i/3) + 11 > num1)? 0x00:(n2a[(r5<<50) >> 58] << 40)) |
		   ((8*(4*i/3) + 12 > num1)? 0x00:(n2a[(r5<<56) >> 58] << 32)) |
		   ((8*(4*i/3) + 13 > num1)? 0x00:(n2a[(r6<<10) >> 58] << 24)) |
		   ((8*(4*i/3) + 14 > num1)? 0x00:(n2a[(r6<<16) >> 58] << 16)) |
		   ((8*(4*i/3) + 15 > num1)? 0x00:(n2a[(r7<<22) >> 58] <<  8)) |
		   ((8*(4*i/3) + 16 > num1)? 0x00:(n2a[(r7<<28) >> 58]));
    am2[4*i/3+1] = ((8*(4*i/3) +  9 > num2)? 0x00:(n2a[(r4<<52) >> 58] << 56)) |
                   ((8*(4*i/3) + 10 > num2)? 0x00:(n2a[(r4<<58) >> 58] << 48)) |
		   ((8*(4*i/3) + 11 > num2)? 0x00:(n2a[(r5<<52) >> 58] << 40)) |
		   ((8*(4*i/3) + 12 > num2)? 0x00:(n2a[(r5<<58) >> 58] << 32)) |
		   ((8*(4*i/3) + 13 > num2)? 0x00:(n2a[(r6<<12) >> 58] << 24)) |
		   ((8*(4*i/3) + 14 > num2)? 0x00:(n2a[(r6<<18) >> 58] << 16)) |
		   ((8*(4*i/3) + 15 > num2)? 0x00:(n2a[(r7<<24) >> 58] <<  8)) |
		   ((8*(4*i/3) + 16 > num2)? 0x00:(n2a[(r7<<30) >> 58]));
  }
  if(4*i/3 + 2 < numw)
  {
    am0[4*i/3+2] = ((8*(4*i/3) + 17 > num0)? 0x00:(n2a[ r8       >> 26] << 56)) |
                   ((8*(4*i/3) + 18 > num0)? 0x00:(n2a[(r8 <<38) >> 58] << 48)) |
		   ((8*(4*i/3) + 19 > num0)? 0x00:(n2a[ r9       >> 14] << 40)) |
		   ((8*(4*i/3) + 20 > num0)? 0x00:(n2a[(r9 <<50) >> 58] << 32)) |
		   ((8*(4*i/3) + 21 > num0)? 0x00:(n2a[ r10      >> 10] << 24)) |
		   ((8*(4*i/3) + 22 > num0)? 0x00:(n2a[(r10<<54) >> 58] << 16)) |
		   ((8*(4*i/3) + 23 > num0)? 0x00:(n2a[ r11      >> 54] <<  8)) |
		   ((8*(4*i/3) + 24 > num0)? 0x00:(n2a[(r11<<10) >> 58]));
    am1[4*i/3+2] = ((8*(4*i/3) + 17 > num1)? 0x00:(n2a[(r8 <<34) >> 58] << 56)) |
                   ((8*(4*i/3) + 18 > num1)? 0x00:(n2a[(r8 <<40) >> 58] << 48)) |
		   ((8*(4*i/3) + 19 > num1)? 0x00:(n2a[(r9 <<46) >> 58] << 40)) |
		   ((8*(4*i/3) + 20 > num1)? 0x00:(n2a[(r9 <<52) >> 58] << 32)) |
		   ((8*(4*i/3) + 21 > num1)? 0x00:(n2a[(r10<<50) >> 58] << 24)) |
		   ((8*(4*i/3) + 22 > num1)? 0x00:(n2a[(r10<<56) >> 58] << 16)) |
		   ((8*(4*i/3) + 23 > num1)? 0x00:(n2a[(r11<< 6) >> 58] <<  8)) |
		   ((8*(4*i/3) + 24 > num1)? 0x00:(n2a[(r11<<12) >> 58]));
    am2[4*i/3+2] = ((8*(4*i/3) + 17 > num2)? 0x00:(n2a[(r8 <<36) >> 58] << 56)) |
                   ((8*(4*i/3) + 18 > num2)? 0x00:(n2a[(r8 <<42) >> 58] << 48)) |
		   ((8*(4*i/3) + 19 > num2)? 0x00:(n2a[(r9 <<48) >> 58] << 40)) |
		   ((8*(4*i/3) + 20 > num2)? 0x00:(n2a[(r9 <<54) >> 58] << 32)) |
		   ((8*(4*i/3) + 21 > num2)? 0x00:(n2a[(r10<<52) >> 58] << 24)) |
		   ((8*(4*i/3) + 22 > num2)? 0x00:(n2a[(r10<<58) >> 58] << 16)) |
		   ((8*(4*i/3) + 23 > num2)? 0x00:(n2a[(r11<< 8) >> 58] <<  8)) |
		   ((8*(4*i/3) + 24 > num2)? 0x00:(n2a[(r11<<14) >> 58]));
  }
  if(4*i/3 + 3 < numw)
  {
    am0[4*i/3+3] = ((8*(4*i/3) + 25 > num0)? 0x00:(n2a[ r12      >> 42] << 56)) |
                   ((8*(4*i/3) + 26 > num0)? 0x00:(n2a[(r12<<22) >> 58] << 48)) |
                   ((8*(4*i/3) + 27 > num0)? 0x00:(n2a[ r13      >> 30] << 40)) |
		   ((8*(4*i/3) + 28 > num0)? 0x00:(n2a[(r13<<34) >> 58] << 32)) |
		   ((8*(4*i/3) + 29 > num0)? 0x00:(n2a[ r14      >> 18] << 24)) |
		   ((8*(4*i/3) + 30 > num0)? 0x00:(n2a[(r14<<46) >> 58] << 16)) |
		   ((8*(4*i/3) + 31 > num0)? 0x00:(n2a[ r15      >>  6] <<  8)) |
		   ((8*(4*i/3) + 32 > num0)? 0x00:(n2a[(r15<<58) >> 58]));
    am1[4*i/3+3] = ((8*(4*i/3) + 25 > num1)? 0x00:(n2a[(r12<<18) >> 58] << 56)) |
                   ((8*(4*i/3) + 26 > num1)? 0x00:(n2a[(r12<<24) >> 58] << 48)) |
                   ((8*(4*i/3) + 27 > num1)? 0x00:(n2a[(r13<<30) >> 58] << 40)) |
		   ((8*(4*i/3) + 28 > num1)? 0x00:(n2a[(r13<<36) >> 58] << 32)) |
		   ((8*(4*i/3) + 29 > num1)? 0x00:(n2a[(r14<<42) >> 58] << 24)) |
		   ((8*(4*i/3) + 30 > num1)? 0x00:(n2a[(r14<<48) >> 58] << 16)) |
		   ((8*(4*i/3) + 31 > num1)? 0x00:(n2a[(r15<<54) >> 58] <<  8));
    am2[4*i/3+3] = ((8*(4*i/3) + 25 > num2)? 0x00:(n2a[(r12<<20) >> 58] << 56)) |
                   ((8*(4*i/3) + 26 > num2)? 0x00:(n2a[(r12<<26) >> 58] << 48)) |
                   ((8*(4*i/3) + 27 > num2)? 0x00:(n2a[(r13<<32) >> 58] << 40)) |
		   ((8*(4*i/3) + 28 > num2)? 0x00:(n2a[(r13<<38) >> 58] << 32)) |
		   ((8*(4*i/3) + 29 > num2)? 0x00:(n2a[(r14<<44) >> 58] << 24)) |
		   ((8*(4*i/3) + 30 > num2)? 0x00:(n2a[(r14<<50) >> 58] << 16)) |
		   ((8*(4*i/3) + 31 > num2)? 0x00:(n2a[(r15<<56) >> 58] <<  8));
  }
#endif /* big_endian */
#ifdef L_ENDIAN

  for(i=0; i<length-3; i+=3)
  {
    r0  = 0x000000000000FFFF & db[i];
    r1  = 0x000000000FFFF000 & db[i];
    r2  = 0x000000FFFF000000 & db[i];
    r3  = 0x000FFFF000000000 & db[i];
    r4  = 0xFFFF000000000000 & db[i];
    r5  = (((unsigned long)      db[i])   >> 60) |
          ((0x0000000000000FFF & db[i+1]) <<  4);
    r6  = 0x0000000000FFFF00 & db[i+1];
    r7  = 0x0000000FFFF00000 & db[i+1];
    r8  = 0x0000FFFF00000000 & db[i+1];
    r9  = 0x0FFFF00000000000 & db[i+1];
    r10 = (((unsigned long)      db[i+1]) >> 56) |
          ((0x00000000000000FF & db[i+2]) <<  8);
    r11 = 0x00000000000FFFF0 & db[i+2];
    r12 = 0x00000000FFFF0000 & db[i+2];
    r13 = 0x00000FFFF0000000 & db[i+2];
    r14 = 0x00FFFF0000000000 & db[i+2];
    r15 = (((unsigned long)db[i+2]) >> 52) | 
          ((unsigned long)(db[i+3]  << 60) >> 48);
    
    am0[4*i/3]   = (n2a[ r0        & 0x3F])       | (n2a[(r0  << 52) >> 58] <<  8) |
		   (n2a[(r1  << 46) >> 58] << 16) | (n2a[(r1  << 40) >> 58] << 24) |
		   (n2a[(r2  << 34) >> 58] << 32) | (n2a[(r2  << 28) >> 58] << 40) |
		   (n2a[(r3  << 22) >> 58] << 48) | (n2a[(r3  << 16) >> 58] << 56);
    
    am0[4*i/3+1] = (n2a[(r4  << 10) >> 58])       | (n2a[(r4  <<  4) >> 58] <<  8) |
		   (n2a[ r5        & 0x3F] << 16) | (n2a[(r5  << 52) >> 58] << 24) |
		   (n2a[(r6  << 50) >> 58] << 32) | (n2a[(r6  << 44) >> 58] << 40) |
		   (n2a[(r7  << 38) >> 58] << 48) | (n2a[(r7  << 32) >> 58] << 56);
    
    am0[4*i/3+2] = (n2a[(r8  << 26) >> 58])       | (n2a[(r8  << 20) >> 58] <<  8) |
		   (n2a[(r9  << 14) >> 58] << 16) | (n2a[(r9  <<  8) >> 58] << 24) |
		   (n2a[(r10 << 58) >> 58] << 32) | (n2a[(r10 << 52) >> 58] << 40) |
		   (n2a[(r11 << 54) >> 58] << 48) | (n2a[(r11 << 48) >> 58] << 56);
    
    am0[4*i/3+3] = (n2a[(r12 << 42) >> 58])       | (n2a[(r12 << 36) >> 58] <<  8) |
                   (n2a[(r13 << 30) >> 58] << 16) | (n2a[(r13 << 24) >> 58] << 24) |
		   (n2a[(r14 << 18) >> 58] << 32) | (n2a[(r14 << 12) >> 58] << 40) |
		   (n2a[(r15 << 58) >> 58] << 48) | (n2a[(r15 << 52) >> 58] << 56);
    
    
    am1[4*i/3]   = (n2a[(r0  << 56) >> 58])       | (n2a[(r0  << 50) >> 58] <<  8) |
		   (n2a[(r1  << 44) >> 58] << 16) | (n2a[(r1  << 38) >> 58] << 24) |
		   (n2a[(r2  << 32) >> 58] << 32) | (n2a[(r2  << 26) >> 58] << 40) |
		   (n2a[(r3  << 20) >> 58] << 48) | (n2a[(r3  << 14) >> 58] << 56);
    
    am1[4*i/3+1] = (n2a[(r4  <<  8) >> 58])       | (n2a[(r4  <<  2) >> 58] <<  8) |
		   (n2a[(r5  << 56) >> 58] << 16) | (n2a[(r5  << 50) >> 58] << 24) |
		   (n2a[(r6  << 48) >> 58] << 32) | (n2a[(r6  << 42) >> 58] << 40) |
		   (n2a[(r7  << 36) >> 58] << 48) | (n2a[(r7  << 30) >> 58] << 56);
    
    am1[4*i/3+2] = (n2a[(r8  << 24) >> 58])       | (n2a[(r8  << 18) >> 58] <<  8) |
		   (n2a[(r9  << 12) >> 58] << 16) | (n2a[(r9  <<  6) >> 58] << 24) |
		   (n2a[(r10 << 56) >> 58] << 32) | (n2a[(r10 << 50) >> 58] << 40) |
		   (n2a[(r11 << 52) >> 58] << 48) | (n2a[(r11 << 46) >> 58] << 56);
    
    am1[4*i/3+3] = (n2a[(r12 << 40) >> 58])       | (n2a[(r12 << 34) >> 58] <<  8) |
                   (n2a[(r13 << 28) >> 58] << 16) | (n2a[(r13 << 22) >> 58] << 24) |
		   (n2a[(r14 << 16) >> 58] << 32) | (n2a[(r14 << 10) >> 58] << 40) |
		   (n2a[(r15 << 56) >> 58] << 48) | (n2a[(r15 << 50) >> 58] << 56);
    
    
    am2[4*i/3]   = (n2a[(r0  << 54) >> 58])       | (n2a[r0  >> 10] <<  8) |
		   (n2a[(r1  << 42) >> 58] << 16) | (n2a[r1  >> 22] << 24) |
		   (n2a[(r2  << 30) >> 58] << 32) | (n2a[r2  >> 34] << 40) |
		   (n2a[(r3  << 18) >> 58] << 48) | (n2a[r3  >> 46] << 56);
    
    am2[4*i/3+1] = (n2a[(r4  <<  6) >> 58])       | (n2a[r4  >> 58] <<  8) |
		   (n2a[(r5  << 54) >> 58] << 16) | (n2a[r5  >> 10] << 24) |
		   (n2a[(r6  << 46) >> 58] << 32) | (n2a[r6  >> 18] << 40) |
		   (n2a[(r7  << 34) >> 58] << 48) | (n2a[r7  >> 30] << 56);
    
    am2[4*i/3+2] = (n2a[(r8  << 22) >> 58])       | (n2a[r8  >> 42] <<  8) |
		   (n2a[(r9  << 10) >> 58] << 16) | (n2a[r9  >> 54] << 24) |
		   (n2a[(r10 << 54) >> 58] << 32) | (n2a[r10 >> 10] << 40) |
		   (n2a[(r11 << 50) >> 58] << 48) | (n2a[r11 >> 14] << 56);
    
    am2[4*i/3+3] = (n2a[(r12 << 38) >> 58])       | (n2a[r12 >> 26] <<  8) |
                   (n2a[(r13 << 26) >> 58] << 16) | (n2a[r13 >> 38] << 24) |
		   (n2a[(r14 << 14) >> 58] << 32) | (n2a[r14 >> 50] << 40) |
		   (n2a[(r15 << 54) >> 58] << 48) | (n2a[r15 >> 10] << 56);
  }
  r0  = 0x000000000000FFFF & db[i];
  r1  = 0x000000000FFFF000 & db[i];
  r2  = 0x000000FFFF000000 & db[i];
  r3  = 0x000FFFF000000000 & db[i];
  r4  = 0xFFFF000000000000 & db[i];
  if(i==length-3)
  {
    r5  = (((unsigned long)      db[i])   >> 60) |
          ((0x0000000000000FFF & db[i+1]) <<  4);
    r6  = 0x0000000000FFFF00 & db[i+1];
    r7  = 0x0000000FFFF00000 & db[i+1];
    r8  = 0x0000FFFF00000000 & db[i+1];
    r9  = 0x0FFFF00000000000 & db[i+1];
    r10 = (((unsigned long)      db[i+1]) >> 56) |
          ((0x00000000000000FF & db[i+2]) <<  8);
    r11 = 0x00000000000FFFF0 & db[i+2];
    r12 = 0x00000000FFFF0000 & db[i+2];
    r13 = 0x00000FFFF0000000 & db[i+2];
    r14 = 0x00FFFF0000000000 & db[i+2];
    r15 = 0xFFF0000000000000 & db[i+2];
  }
  else if(i==length-2)
  {
    r5  = (((unsigned long)      db[i])   >> 60) |
          ((0x0000000000000FFF & db[i+1]) <<  4);
    r6  = 0x0000000000FFFF00 & db[i+1];
    r7  = 0x0000000FFFF00000 & db[i+1];
    r8  = 0x0000FFFF00000000 & db[i+1];
    r9  = 0x0FFFF00000000000 & db[i+1];
    r10 = ((unsigned long)db[i+1]) >> 56;
    r11 = r12 = r13 = r14 = r15 = 0x0;
  }
  else
  {
    r5  = ((unsigned long)db[i]) >> 60;
    r6 = r7 = r8 = r9 = r10 = r11 = r12 = r13 = r14 = r15 = 0x0;
  }
  if(4*i/3 < numw)
  {
    am0[4*i/3] = ((8*(4*i/3) + 1 > num0)? 0x00:(n2a[ r0        & 0x3F]))       | 
                 ((8*(4*i/3) + 2 > num0)? 0x00:(n2a[(r0  << 52) >> 58] <<  8)) |
		 ((8*(4*i/3) + 3 > num0)? 0x00:(n2a[(r1  << 46) >> 58] << 16)) | 
		 ((8*(4*i/3) + 4 > num0)? 0x00:(n2a[(r1  << 40) >> 58] << 24)) |
		 ((8*(4*i/3) + 5 > num0)? 0x00:(n2a[(r2  << 34) >> 58] << 32)) | 
		 ((8*(4*i/3) + 6 > num0)? 0x00:(n2a[(r2  << 28) >> 58] << 40)) |
		 ((8*(4*i/3) + 7 > num0)? 0x00:(n2a[(r3  << 22) >> 58] << 48)) | 
		 ((8*(4*i/3) + 8 > num0)? 0x00:(n2a[(r3  << 16) >> 58] << 56));
    am1[4*i/3] = ((8*(4*i/3) + 1 > num1)? 0x00:(n2a[(r0  << 56) >> 58]))       | 
                 ((8*(4*i/3) + 2 > num1)? 0x00:(n2a[(r0  << 50) >> 58] <<  8)) |
		 ((8*(4*i/3) + 3 > num1)? 0x00:(n2a[(r1  << 44) >> 58] << 16)) | 
		 ((8*(4*i/3) + 4 > num1)? 0x00:(n2a[(r1  << 38) >> 58] << 24)) |
		 ((8*(4*i/3) + 5 > num1)? 0x00:(n2a[(r2  << 32) >> 58] << 32)) | 
		 ((8*(4*i/3) + 6 > num1)? 0x00:(n2a[(r2  << 26) >> 58] << 40)) |
		 ((8*(4*i/3) + 7 > num1)? 0x00:(n2a[(r3  << 20) >> 58] << 48)) | 
		 ((8*(4*i/3) + 8 > num1)? 0x00:(n2a[(r3  << 14) >> 58] << 56));
    am2[4*i/3] = ((8*(4*i/3) + 1 > num2)? 0x00:(n2a[(r0  << 54) >> 58]))       | 
                 ((8*(4*i/3) + 2 > num2)? 0x00:(n2a[ r0  >> 10] <<  8))        |
		 ((8*(4*i/3) + 3 > num2)? 0x00:(n2a[(r1  << 42) >> 58] << 16)) | 
		 ((8*(4*i/3) + 4 > num2)? 0x00:(n2a[ r1  >> 22] << 24))        |
		 ((8*(4*i/3) + 5 > num2)? 0x00:(n2a[(r2  << 30) >> 58] << 32)) | 
		 ((8*(4*i/3) + 6 > num2)? 0x00:(n2a[ r2  >> 34] << 40))        |
		 ((8*(4*i/3) + 7 > num2)? 0x00:(n2a[(r3  << 18) >> 58] << 48)) | 
		 ((8*(4*i/3) + 8 > num2)? 0x00:(n2a[ r3  >> 46] << 56));
  }
  if(4*i/3 + 1 < numw)
  {
    am0[4*i/3+1] = ((8*(4*i/3) +  9 > num0)? 0x00:(n2a[(r4 << 10) >> 58]))       |
                   ((8*(4*i/3) + 10 > num0)? 0x00:(n2a[(r4 <<  4) >> 58] <<  8)) |
		   ((8*(4*i/3) + 11 > num0)? 0x00:(n2a[ r5       & 0x3F] << 16)) |
		   ((8*(4*i/3) + 12 > num0)? 0x00:(n2a[(r5 << 52) >> 58] << 24)) |
		   ((8*(4*i/3) + 13 > num0)? 0x00:(n2a[(r6 << 50) >> 58] << 32)) |
		   ((8*(4*i/3) + 14 > num0)? 0x00:(n2a[(r6 << 44) >> 58] << 40)) |
		   ((8*(4*i/3) + 15 > num0)? 0x00:(n2a[(r7 << 38) >> 58] << 48)) |
		   ((8*(4*i/3) + 16 > num0)? 0x00:(n2a[(r7 << 32) >> 58] << 56));
    am1[4*i/3+1] = ((8*(4*i/3) +  9 > num1)? 0x00:(n2a[(r4 <<  8) >> 58]))       |
                   ((8*(4*i/3) + 10 > num1)? 0x00:(n2a[(r4 <<  2) >> 58] <<  8)) |
		   ((8*(4*i/3) + 11 > num1)? 0x00:(n2a[(r5 << 56) >> 58] << 16)) |
		   ((8*(4*i/3) + 12 > num1)? 0x00:(n2a[(r5 << 50) >> 58] << 24)) |
		   ((8*(4*i/3) + 13 > num1)? 0x00:(n2a[(r6 << 48) >> 58] << 32)) |
		   ((8*(4*i/3) + 14 > num1)? 0x00:(n2a[(r6 << 42) >> 58] << 40)) |
		   ((8*(4*i/3) + 15 > num1)? 0x00:(n2a[(r7 << 36) >> 58] << 48)) |
		   ((8*(4*i/3) + 16 > num1)? 0x00:(n2a[(r7 << 30) >> 58] << 56));
    am2[4*i/3+1] = ((8*(4*i/3) +  9 > num2)? 0x00:(n2a[(r4 <<  6) >> 58]))       |
                   ((8*(4*i/3) + 10 > num2)? 0x00:(n2a[ r4 >> 58] <<  8))        |
		   ((8*(4*i/3) + 11 > num2)? 0x00:(n2a[(r5 << 54) >> 58] << 16)) |
		   ((8*(4*i/3) + 12 > num2)? 0x00:(n2a[ r5 >> 10] << 24))        |
		   ((8*(4*i/3) + 13 > num2)? 0x00:(n2a[(r6 << 46) >> 58] << 32)) |
		   ((8*(4*i/3) + 14 > num2)? 0x00:(n2a[ r6 >> 18] << 40))        |
		   ((8*(4*i/3) + 15 > num2)? 0x00:(n2a[(r7 << 34) >> 58] << 48)) |
		   ((8*(4*i/3) + 16 > num2)? 0x00:(n2a[ r7 >> 30] << 56));
  }
  if(4*i/3 + 2 < numw)
  {
    am0[4*i/3+2] = ((8*(4*i/3) + 17 > num0)? 0x00:(n2a[(r8  << 26) >> 58]))       |
                   ((8*(4*i/3) + 18 > num0)? 0x00:(n2a[(r8  << 20) >> 58] <<  8)) |
		   ((8*(4*i/3) + 19 > num0)? 0x00:(n2a[(r9  << 14) >> 58] << 16)) |
		   ((8*(4*i/3) + 20 > num0)? 0x00:(n2a[(r9  <<  8) >> 58] << 24)) |
		   ((8*(4*i/3) + 21 > num0)? 0x00:(n2a[(r10 << 58) >> 58] << 32)) |
		   ((8*(4*i/3) + 22 > num0)? 0x00:(n2a[(r10 << 52) >> 58] << 40)) |
		   ((8*(4*i/3) + 23 > num0)? 0x00:(n2a[(r11 << 54) >> 58] << 48)) |
		   ((8*(4*i/3) + 24 > num0)? 0x00:(n2a[(r11 << 48) >> 58] << 56));
    am1[4*i/3+2] = ((8*(4*i/3) + 17 > num1)? 0x00:(n2a[(r8  << 24) >> 58]))       |
                   ((8*(4*i/3) + 18 > num1)? 0x00:(n2a[(r8  << 18) >> 58] <<  8)) |
		   ((8*(4*i/3) + 19 > num1)? 0x00:(n2a[(r9  << 12) >> 58] << 16)) |
		   ((8*(4*i/3) + 20 > num1)? 0x00:(n2a[(r9  <<  6) >> 58] << 24)) |
		   ((8*(4*i/3) + 21 > num1)? 0x00:(n2a[(r10 << 56) >> 58] << 32)) |
		   ((8*(4*i/3) + 22 > num1)? 0x00:(n2a[(r10 << 50) >> 58] << 40)) |
		   ((8*(4*i/3) + 23 > num1)? 0x00:(n2a[(r11 << 52) >> 58] << 48)) |
		   ((8*(4*i/3) + 24 > num1)? 0x00:(n2a[(r11 << 46) >> 58] << 56));
    am2[4*i/3+2] = ((8*(4*i/3) + 17 > num2)? 0x00:(n2a[(r8  << 22) >> 58]))       |
                   ((8*(4*i/3) + 18 > num2)? 0x00:(n2a[ r8  >> 42] <<  8))        |
		   ((8*(4*i/3) + 19 > num2)? 0x00:(n2a[(r9  << 10) >> 58] << 16)) |
		   ((8*(4*i/3) + 20 > num2)? 0x00:(n2a[ r9  >> 54] << 24))        |
		   ((8*(4*i/3) + 21 > num2)? 0x00:(n2a[(r10 << 54) >> 58] << 32)) |
		   ((8*(4*i/3) + 22 > num2)? 0x00:(n2a[ r10 >> 10] << 40))        |
		   ((8*(4*i/3) + 23 > num2)? 0x00:(n2a[(r11 << 50) >> 58] << 48)) |
		   ((8*(4*i/3) + 24 > num2)? 0x00:(n2a[ r11 >> 14] << 56));
  }
  if(4*i/3 + 3 < numw)
  {
    am0[4*i/3+3] = ((8*(4*i/3) + 25 > num0)? 0x00:(n2a[(r12 << 42) >> 58]))       |
                   ((8*(4*i/3) + 26 > num0)? 0x00:(n2a[(r12 << 36) >> 58] <<  8)) |
                   ((8*(4*i/3) + 27 > num0)? 0x00:(n2a[(r13 << 30) >> 58] << 16)) |
		   ((8*(4*i/3) + 28 > num0)? 0x00:(n2a[(r13 << 24) >> 58] << 24)) |
		   ((8*(4*i/3) + 29 > num0)? 0x00:(n2a[(r14 << 18) >> 58] << 32)) |
		   ((8*(4*i/3) + 30 > num0)? 0x00:(n2a[(r14 << 12) >> 58] << 40)) |
		   ((8*(4*i/3) + 31 > num0)? 0x00:(n2a[(r15 <<  6) >> 58] << 48)) |
		   ((8*(4*i/3) + 32 > num0)? 0x00:(n2a[ r15        >> 58] << 56));
    am1[4*i/3+3] = ((8*(4*i/3) + 25 > num1)? 0x00:(n2a[(r12 << 40) >> 58]))       |
                   ((8*(4*i/3) + 26 > num1)? 0x00:(n2a[(r12 << 34) >> 58] <<  8)) |
                   ((8*(4*i/3) + 27 > num1)? 0x00:(n2a[(r13 << 28) >> 58] << 16)) |
		   ((8*(4*i/3) + 28 > num1)? 0x00:(n2a[(r13 << 22) >> 58] << 24)) |
		   ((8*(4*i/3) + 29 > num1)? 0x00:(n2a[(r14 << 16) >> 58] << 32)) |
		   ((8*(4*i/3) + 30 > num1)? 0x00:(n2a[(r14 << 10) >> 58] << 40)) |
		   ((8*(4*i/3) + 31 > num1)? 0x00:(n2a[(r15 <<  4) >> 58] << 48));
    am2[4*i/3+3] = ((8*(4*i/3) + 25 > num2)? 0x00:(n2a[(r12 << 38) >> 58]))       |
                   ((8*(4*i/3) + 26 > num2)? 0x00:(n2a[ r12 >> 26] <<  8))        |
                   ((8*(4*i/3) + 27 > num2)? 0x00:(n2a[(r13 << 26) >> 58] << 16)) |
		   ((8*(4*i/3) + 28 > num2)? 0x00:(n2a[ r13 >> 38] << 24))        |
		   ((8*(4*i/3) + 29 > num2)? 0x00:(n2a[(r14 << 14) >> 58] << 32)) |
		   ((8*(4*i/3) + 30 > num2)? 0x00:(n2a[ r14 >> 50] << 40))        |
		   ((8*(4*i/3) + 31 > num2)? 0x00:(n2a[(r15 <<  2) >> 58] << 48));
  }
#endif /* little_endian */
#endif /* 64-bit */
}

/*
cb_amino_translate_ascii(3B)                                Last changed: 09-17-02

NAME
        cb_amino_translate_ascii - translate nucleotides to amino acids

SYNOPSIS

        C/C++:

        #include <cbl.h>
        void cb_amino_translate_ascii( long *db, long dblen, 
                                       long *am0, long *am1, long *am2 );

        Fortran:

        use cb_amino
        call cb_amino_translate_ascii( db, dblen, am0, am1, am2 )


IMPLEMENTATION

        Cray SV1 series UNICOS systems

DESCRIPTION

        cb_amino_translate_ascii converts an input sequence of nucleotides into three
        sequences of amino acids, one for each reading frame. The input nucleotide
        sequence must be in the 2-bit compressed format. The output amino acids are
        represented by ASCII characters.  Memory for the output arrays, am0, am1, 
        and am3, must be allocated before calling cb_amino_translate_ascii, and must 
        contain at least (dblen/3+7)/8 words each.

        db      (input) nucleotide sequnece in 2-bit compression format. See
                cb_compress(3B) for details on compression. In Fortran, db
                should be an INTEGER(8) array.

        dblen   (input) number of nucleotide codes packed into db. In Fortran,
                dblen should be an INTEGER(8) variable, constant, or expression.

        am0     (output) sequence of amino acids translated from reading frame 0
                of the input nucleotide sequence in db. Reading frame 0 starts
                encoding at the first nucleotide in db. In Fortran, am0 should
                be an INTEGER(8) array.

        am1     (output) sequence of amino acids for reading frame 1. 
                Reading frame 1 starts encoding with the second nucleotide in
                db. In Fortran, am1 should be an INTEGER(8) array.

        am2     (output) sequence of amino acids for reading frame 2.
                Reading frame 2 starts encoding this the third nucleotide in
                db. In Fortran, am2 should be an INTEGER(8) array.

NOTES       

        cb_amino_translate_ascii translates nucleotides from the three reading
        frames in the forward direction.  To get the other three reading frames
        from the reverse complement direction, create a reverse complement version
        of db using the cb_revcompl routine, and call cb_amino_translate_ascii a
        second time.

        cb_amino_translate_ascii is single-threaded (i.e. not tasked) and may be called 
        from within a parallel region.  If it is called in a parallel region, it must
        be called once prior to entering the parallel region to set up internal
        tables. This call can be made with dblen=0.

        cb_amino_translate_ascii replaces the contents of the bmm register.

SEE ALSO

        cb_compress(3B), cb_revcompl(3B), INTRO_LIBCBL(3B)
*/

